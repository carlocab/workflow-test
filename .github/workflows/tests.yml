name: CI
on: push

jobs:
  debug:
    strategy:
      matrix:
        old-brew-checkout: [true, false]
      fail-fast: false
    runs-on: macos-latest
    steps:
      - uses: Homebrew/actions/setup-homebrew@master
        with:
          test-bot: true

      - run: brew test-bot --only-cleanup-before

      - run: brew test-bot --only-setup

      - name: Checkout `brew` revision
        if: matrix.old-brew-checkout
        run: git -C "$(brew --repository)" checkout 9f9ae1edeb07d0e7790f18fd540ca76228a3eec2

      - run: brew tap shivammathur/php

      - run: |
          cd "$(brew --repo shivammathur/php)"
          git fetch origin pull/1844/head
          git checkout FETCH_HEAD

      - run: brew install --build-bottle --verbose --debug shivammathur/php/php@8.3

      - run: brew bottle --verbose --debug shivammathur/php/php@8.3
